# PROMPTS.md
# Codex 提示词模板（长期有效，中文，复制粘贴用）

> 目标：将“上下文”固化到仓库文件，使 Codex 不依赖聊天窗口记忆。
> 使用方式：每次启动 Codex，先用【0.标准开场】，再用【1.执行任务】指定任务 ID。

---

## 0. 标准开场（每次启动 Codex 第一句）

请先阅读并严格遵守以下文件，并以 ai-docs/CURRENT.md 为最高优先级执行：
- ai-docs/PROJECT.md
- ai-docs/AGENTS.md
- ai-docs/CONTEXT.md
- ai-docs/CURRENT.md
- ai-docs/TASKS.md
- ai-docs/PROMPTS.md

阅读后用不超过 10 行总结：
1) 当前阶段目标（3-5 条）
2) 本阶段禁止事项（3 条以内）
3) 你接下来准备执行的任务 ID（从 TASKS.md 顶部第一条未完成开始）
4) 本次将运行的验证命令（至少 2 条）

如有任何冲突/不确定，先提问，不要猜，不要擅自扩展需求。

---

## 1. 执行一条任务（最常用）

现在执行 TASKS.md 中的任务：<任务ID>。

强制要求：
1) 一次只做这一条任务，不要顺手做别的
2) 先输出“执行计划”再改代码。计划必须包含：
   - 将修改/新增的文件清单
   - 关键设计决策（不超过 8 行）
   - 将运行的验证命令（含 docker compose / curl / pytest / scripts）
   - 回滚方式（如果改坏了怎么撤）
3) 实施时改动最小化，禁止无关重构
4) 完成后必须：
   - 运行验证命令并贴关键输出
   - 更新 README 或 scripts（保证别人可复现）
   - 输出“验收对照表”，逐条对照 TASKS.md 的验收项（是/否 + 证据）

---

## 2. 仅输出方案，不改代码（用于我先审一下）

不要改代码。请针对任务 <任务ID> 输出详细实施方案，必须包含：
- 数据库 schema（字段/索引/关系）与迁移策略
- API 输入/输出 JSON 示例
- 关键边界条件（索引未建/资料不足/字段缺失）
- 验证命令与 smoke 如何更新
- 风险点与最小回滚策略

---

## 3. Bug 修复（我负责找 bug，你负责修）

我发现一个 Bug，请修复，保持改动最小化，不要重构无关代码。

现象：
- <贴错误信息/截图文字/返回 JSON>

复现步骤：
1) <命令或接口>
2) <输入数据>

期望行为：
- <应该怎样>

强制要求：
1) 先定位根因：指出代码位置与证据（日志/堆栈/输入输出差异）
2) 给出最小修复（尽量少改文件）
3) 加防回归：pytest 或 scripts/dev_smoke.sh 中新增检查
4) 给出验证命令与关键输出

---

## 4. 自检 / 评审（让你自己审自己）

请对最近一次变更做一次自检 review，检查点：
- 是否违反 ai-docs/AGENTS.md（尤其：擅自加依赖/大重构）
- API 返回码与错误信息是否明确（409/400/422 等是否合理）
- 数据是否落库可查（不是仅内存）
- README/scripts 是否已更新且可复现
- 是否存在静默失败/吞异常
输出：
- 问题清单（按优先级）
- 建议修复
- 是否“可合并”的结论

---

## 5. 任务推进策略（当你不知道下一步做啥时）

如果你完成了当前任务且不确定下一步：
- 回到 ai-docs/TASKS.md，找到下一条未完成任务执行
- 若任务队列为空，输出：
  - 当前系统还有哪些明显缺口（按可用性优先）
  - 建议新增的 3 条任务（带验收标准）
不要自行扩展功能实现，必须先写入 TASKS.md 再执行。