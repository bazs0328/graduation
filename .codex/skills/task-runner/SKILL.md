---
name: task-runner
description: 从 ai-docs/TASKS.md 提取下一条未完成任务，先产出计划（优先使用 $create-plan），再实施并给出变更清单与验收对照；用于推进单条任务、执行任务清单或要求输出验证方式时。
---

# task-runner

## 目标
- 从 TASKS.md 锁定第一条未完成任务并仅推进这一条
- 先产出可执行计划，再实施最小改动
- 交付可复现验收：变更清单、验收对照表、验证命令

## 触发条件
- 用户要求“按 TASKS 推进/执行下一条任务/完成任务”
- 需要输出计划 + 实施 + 验收对照
- 要求列出变更文件与验证命令

## 输入
- ai-docs/TASKS.md 的任务列表
- 当前仓库状态与相关代码/脚本
- 用户的补充约束（如范围、截止、风险）

## 输出
- 任务计划（若 $create-plan 可用则为其输出）
- 实施结果与变更文件清单
- 验收对照表（任务要求 → 验证方式）
- 最少 1 条可复现验证命令

## 步骤
1. 读取并理解：ai-docs/PROJECT.md、ai-docs/AGENTS.md、ai-docs/CONTEXT.md、ai-docs/CURRENT.md、ai-docs/TASKS.md；若任一文件缺失或无法读取，停止并询问
2. 在 TASKS.md 中找到第一条未完成任务，原样引用任务标题/标记
3. 若 $create-plan 可用，先调用 create-plan 生成计划；否则输出简短计划
4. 仅实施该任务，保持改动最小化，不额外扩展范围
5. 强制补充可复现入口：更新 README 或新增/更新 scripts（只做与本任务相关的最小改动）
6. 输出：变更文件清单 + 验收对照表 + 验证命令

## 护栏
- 一次只做一件事：只处理 TASKS.md 的第一条未完成任务
- 改动最小化，禁止无关重构或更换技术栈
- 必须给出可复现验证（curl / scripts / pytest 其一或组合）
- 如需引入新依赖、改目录结构或大幅修改数据库，先询问用户

## 验收命令
- `bash scripts/dev_smoke.sh`（若存在且与任务相关）
- `pytest -q`（若涉及 Python 逻辑或回归）
- `curl -X ...`（按任务新增的接口示例至少 1 条）

## 失败处理
- 如验证失败，先定位最小修复点并说明原因与影响范围
- 环境/依赖不足导致无法验证时，明确列出缺口并请求用户补充
- 不得隐藏错误或宣称“已完成”而无验证证据
