---
name: bug-triage
description: Bug 定位与最小修复流程（现象→复现→根因证据→修复→回归验证）；用于用户报 bug、异常回归或需要给出最小修复与验证时。
---

# bug-triage

## 目标
- 复现并定位根因
- 给出最小修复
- 添加防回归验证

## 触发条件
- 用户报告 bug 或异常行为
- 需要输出根因证据 + 修复 + 验证命令

## 输入
- 现象描述
- 复现步骤
- 期望行为

## 输出
- 根因证据（日志/代码路径/最小复现）
- 最小修复方案与变更文件清单
- 防回归验证（pytest 或 smoke）
- 验证命令

## 步骤
1. 读取并理解：ai-docs/PROJECT.md、ai-docs/AGENTS.md、ai-docs/CONTEXT.md、ai-docs/CURRENT.md、ai-docs/TASKS.md；若任一文件缺失或无法读取，停止并询问
2. 按输入复现问题并收集日志/证据
3. 定位根因（给出代码位置或配置证据）
4. 实施最小修复，不扩展范围
5. 添加防回归验证并运行
6. 输出验证结果与命令

## 护栏
- 一次只处理一个 bug
- 改动最小化，不引入新框架
- 必须给可复现验证（pytest 或 smoke）
- 若无法复现或信息不足，先询问用户补充

## 验收命令
- `pytest -q`
- `bash scripts/dev_smoke.sh`

## 失败处理
- 无法复现时，列出缺失信息并请求补充
- 修复失败时，回退到最小变更并说明风险
